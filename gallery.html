<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photo Gallery - EwaFemi2025 Wedding</title>
    <script>
      // Global handler for guest message forms
      window.showGuestMessageSuccess = function(formId, successId) {
        console.log(`Global handler called for form ${formId} and success ${successId}`);
        const form = document.getElementById(formId);
        const success = document.getElementById(successId);
        if (form && success) {
          form.style.display = 'none';
          success.style.display = 'block';
          setTimeout(() => {
            success.classList.add('animate-in');
          }, 10);
        }
      };
    </script>
    <meta
      name="description"
      content="Browse through our beautiful collection of photos from engagement to wedding day"
    />
    <meta
      name="keywords"
      content="wedding, Beauty, Femi, 2025, Lagos, Nigeria, gallery, photos"
    />

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles/style.css">
    <link rel="stylesheet" href="styles/responsive-fixes.css">
    <link rel="stylesheet" href="styles/form-messages.css">
    <link rel="stylesheet" href="styles/rsvp.css">
    <!-- Gallery Styles -->
    <link rel="stylesheet" href="styles/gallery-styles.css">
    
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "ImageGallery",
      "name": "Beauty & Femi's Wedding Gallery",
      "about": {
        "@type": "Event",
        "name": "Beauty & Femi's Wedding",
        "startDate": "2025-09-26T16:00:00",
        "endDate": "2025-09-26T23:00:00",
        "location": {
          "@type": "Place",
          "name": "Grace Cathedral",
          "address": {
            "@type": "PostalAddress",
            "addressLocality": "Lagos",
            "addressCountry": "Nigeria"
          }
        }
      },
      "image": "/images/couple-main.jpg",
      "description": "Photo gallery from Beauty and Femi's wedding celebration"
    }
    </script>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
      <div class="loading-content">
        <div class="loading-rings">
          <div class="ring"></div>
          <div class="ring"></div>
          <div class="ring"></div>
        </div>
        <h3 class="loading-text">EwaFemi2025</h3>
      </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top custom-navbar" id="mainNavbar">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <span class="brand-text">B & F</span>
                <small class="brand-year">2025</small>
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto" id="navbarMenu">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">
                            <i class="bi bi-house"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="rsvp.html" id="rsvp-nav-link">
                            <i class="bi bi-heart-fill"></i> RSVP
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Gallery Hero Section -->
        <section class="gallery-hero d-flex align-items-center">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 mx-auto text-center">
                        <h1 class="display-4 mb-4">Our Gallery</h1>
                        <p class="lead mb-0">Capturing the beautiful moments of our love story</p>
                    </div>
                </div>
            </div>
        </section>

    <!-- Gallery Stats -->
    <section class="gallery-stats">
        <div class="container">
            <div class="row">
                <div class="col-md-3 col-6">
                    <div class="stat-item">
                        <div class="stat-number" id="totalPhotos">0</div>
                        <div class="stat-label">Total Photos</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-item">
                        <div class="stat-number" id="photoCategories">0</div>
                        <div class="stat-label">Photo Categories</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-item">
                        <div class="stat-number" id="daysTogether">0</div>
                        <div class="stat-label">Days Together</div>
                    </div>
                </div>
                <div class="col-md-3 col-6">
                    <div class="stat-item">
                        <div class="stat-number" id="memoriesCount">∞</div>
                        <div class="stat-label">Love & Memories</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Gallery Navigation and Content -->
    <section class="gallery-section py-5">
        <div class="container">
            <!-- Category Navigation -->
            <ul class="nav nav-pills gallery-nav-tabs" id="galleryTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="all-tab" data-bs-toggle="pill" data-bs-target="#all" 
                            type="button" role="tab" aria-controls="all" aria-selected="true">
                        <i class="bi bi-grid-3x3-gap"></i> All Photos
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="engagement-tab" data-bs-toggle="pill" data-bs-target="#engagement" 
                            type="button" role="tab" aria-controls="engagement" aria-selected="false">
                        <i class="bi bi-heart"></i> Engagement
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="prewedding-tab" data-bs-toggle="pill" data-bs-target="#prewedding" 
                            type="button" role="tab" aria-controls="prewedding" aria-selected="false">
                        <i class="bi bi-camera"></i> Pre-Wedding
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="throwback-tab" data-bs-toggle="pill" data-bs-target="#throwback" 
                            type="button" role="tab" aria-controls="throwback" aria-selected="false">
                        <i class="bi bi-clock-history"></i> Throwback
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="wedding-tab" data-bs-toggle="pill" data-bs-target="#wedding" 
                            type="button" role="tab" aria-controls="wedding" aria-selected="false">
                        <i class="bi bi-camera-reels"></i> Wedding Day
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="traditionalCeremony-tab" data-bs-toggle="pill" data-bs-target="#traditionalCeremony" 
                            type="button" role="tab" aria-controls="traditionalCeremony" aria-selected="false">
                        <i class="bi bi-flower1"></i> Traditional
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="christmas-tab" data-bs-toggle="pill" data-bs-target="#christmas" 
                            type="button" role="tab" aria-controls="christmas" aria-selected="false">
                        <i class="bi bi-snow"></i> Christmas
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="galleryTabContent">
                <!-- All Photos Tab -->
                <div class="tab-pane fade show active" id="all" role="tabpanel" aria-labelledby="all-tab">
                    <div class="category-description">
                        <p>All our beautiful memories captured in one place</p>
                    </div>
                    <div class="photo-grid" id="allPhotosGrid">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading photos...</p>
                        </div>
                    </div>
                </div>

                <!-- Engagement Photos Tab -->
                <div class="tab-pane fade" id="engagement" role="tabpanel" aria-labelledby="engagement-tab">
                    <div class="category-description">
                        <p>The moment we said "Yes!" to forever together</p>
                    </div>
                    <div class="photo-grid" id="engagementPhotosGrid">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading engagement photos...</p>
                        </div>
                    </div>
                </div>

                <!-- Pre-Wedding Photos Tab -->
                <div class="tab-pane fade" id="prewedding" role="tabpanel" aria-labelledby="prewedding-tab">
                    <div class="category-description">
                        <p>Beautiful pre-wedding moments leading up to our special day</p>
                    </div>
                    <div class="photo-grid" id="preweddingPhotosGrid">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading pre-wedding photos...</p>
                        </div>
                    </div>
                </div>

                <!-- Throwback Photos Tab -->
                <div class="tab-pane fade" id="throwback" role="tabpanel" aria-labelledby="throwback-tab">
                    <div class="category-description">
                        <p>Sweet memories from our journey together before engagement</p>
                    </div>
                    <div class="photo-grid" id="throwbackPhotosGrid">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading throwback photos...</p>
                        </div>
                    </div>
                </div>

                <!-- Wedding Day Photos Tab -->
                <div class="tab-pane fade" id="wedding" role="tabpanel" aria-labelledby="wedding-tab">
                    <div class="category-description">
                        <p>Our magical wedding day - coming soon!</p>
                    </div>
                    <div class="photo-grid" id="weddingPhotosGrid">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading wedding photos...</p>
                        </div>
                    </div>
                </div>

                <!-- Traditional Ceremony Photos Tab -->
                <div class="tab-pane fade" id="traditionalCeremony" role="tabpanel" aria-labelledby="traditionalCeremony-tab">
                    <div class="category-description">
                        <p>Beautiful traditional wedding ceremony moments</p>
                    </div>
                    <div class="photo-grid" id="traditionalCeremonyPhotosGrid">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading traditional ceremony photos...</p>
                        </div>
                    </div>
                </div>

                <!-- Christmas Photos Tab -->
                <div class="tab-pane fade" id="christmas" role="tabpanel" aria-labelledby="christmas-tab">
                    <div class="category-description">
                        <p>Festive Christmas moments and celebrations</p>
                    </div>
                    <div class="photo-grid" id="christmasPhotosGrid">
                        <div class="loading-spinner">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">Loading Christmas photos...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Lightbox Modal -->
    <div class="modal fade lightbox-modal" id="lightboxModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center p-0">
                    <img src="" alt="" class="img-fluid" id="lightboxImage">
                    <div class="lightbox-caption p-3">
                        <h5 id="lightboxTitle"></h5>
                        <p id="lightboxDescription" class="mb-0"></p>
                    </div>
                </div>
                <div class="modal-footer border-0 justify-content-center">
                    <button type="button" class="btn btn-outline-light" id="prevPhoto">
                        <i class="bi bi-chevron-left"></i> Previous
                    </button>
                    <button type="button" class="btn btn-outline-light" id="nextPhoto">
                        Next <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Mobile Navigation Controls -->
        <button type="button" class="lightbox-mobile-close" id="mobileCloseBtn" data-bs-dismiss="modal" aria-label="Close">
            <i class="bi bi-x"></i>
        </button>
        
        <button type="button" class="lightbox-mobile-controls lightbox-mobile-prev lightbox-mobile-nav" id="mobilePrevBtn">
            <i class="bi bi-chevron-left"></i>
        </button>
        
        <button type="button" class="lightbox-mobile-controls lightbox-mobile-next lightbox-mobile-nav" id="mobileNextBtn">
            <i class="bi bi-chevron-right"></i>
        </button>
    </div>

    <!-- RSVP Section -->
    <section id="rsvp" class="section py-5">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="section-header text-center">
                        <h2 class="section-title mb-4">
                            <i class="bi bi-heart-fill"></i> RSVP
                        </h2>
                        <p class="section-subtitle">
                            We're so excited to celebrate with you! Please respond by <strong>August 31, 2025</strong>
                        </p>
                    </div>
                    
                    <!-- RSVP Form -->
                    <div id="embeddedRsvpForm" class="card-custom">
                        <div class="card-body">
                            <form id="galleryRsvpForm" class="form-custom">
                                <!-- Personal Information -->
                                <div class="form-section mb-4">
                                    <h4 class="form-section-title">
                                        <i class="bi bi-person"></i> Personal Information
                                    </h4>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="firstName" class="form-label">First Name *</label>
                                            <input type="text" class="form-control" id="firstName" name="firstName" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="lastName" class="form-label">Last Name *</label>
                                            <input type="text" class="form-control" id="lastName" name="lastName" required>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6 mb-3">
                                            <label for="email" class="form-label">Email Address *</label>
                                            <input type="email" class="form-control" id="email" name="email" required>
                                        </div>
                                        <div class="col-md-6 mb-3">
                                            <label for="phone" class="form-label">Phone Number</label>
                                            <input type="tel" class="form-control" id="phone" name="phone">
                                        </div>
                                    </div>
                                </div>

                                <!-- Attendance -->
                                <div class="form-section mb-4">
                                    <h4 class="form-section-title">
                                        <i class="bi bi-calendar-check"></i> Attendance
                                    </h4>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Will you be attending? *</label>
                                        <div class="attendance-options">
                                            <div class="form-check form-check-custom">
                                                <input class="form-check-input" type="radio" name="attendance" id="attendingYes" value="yes" required>
                                                <label class="form-check-label" for="attendingYes">
                                                    <i class="bi bi-heart-fill text-primary-custom"></i>
                                                    Yes, I'll be there! Can't wait to celebrate with you!
                                                </label>
                                            </div>
                                            <div class="form-check form-check-custom">
                                                <input class="form-check-input" type="radio" name="attendance" id="attendingNo" value="no" required>
                                                <label class="form-check-label" for="attendingNo">
                                                    <i class="bi bi-heart text-muted"></i>
                                                    Sorry, I can't make it, but I'm thinking of you!
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Special Message -->
                                <div class="form-section mb-4">
                                    <h4 class="form-section-title">
                                        <i class="bi bi-chat-heart"></i> Special Message
                                    </h4>
                                    
                                    <div class="mb-3">
                                        <label for="specialMessage" class="form-label">Leave us a special message or blessing</label>
                                        <textarea class="form-control" id="specialMessage" name="specialMessage" rows="4" placeholder="We'd love to hear your thoughts, wishes, or any special memories you'd like to share..."></textarea>
                                    </div>
                                </div>

                                <!-- Submit Button -->
                                <div class="text-center">
                                    <button type="submit" class="btn btn-primary-custom btn-lg px-5">
                                        <i class="bi bi-heart-fill"></i> Submit RSVP
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Confirmation Message (hidden initially) -->
                    <div id="confirmationMessage" class="card-custom mt-4" style="display: none;">
                        <div class="card-body text-center">
                            <i class="bi bi-check-circle display-4 text-success mb-3"></i>
                            <h3>Thank You!</h3>
                            <p class="lead">Your RSVP has been submitted successfully.</p>
                            <p>We can't wait to celebrate with you on our special day!</p>
                            <a href="index.html" class="btn btn-outline-custom">
                                <i class="bi bi-house"></i> Back to Home
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <!-- Footer content will be loaded dynamically from JSON -->
    </footer>

    <!-- Gallery JavaScript -->
    <script type="text/javascript">
        class GalleryManager {
            constructor() {
                this.currentCategory = 'all';
                this.currentPhotoIndex = 0;
                this.currentPhotos = [];
                this.allPhotos = [];
                this.photoCategories = {
                    portrait: [],
                    engagement: [],
                    prewedding: [],
                    throwback: [],
                    wedding: [],
                    traditionalCeremony: [],
                    christmas: [],
                    whiteWedding: [],
                    specialMoments: []
                };
                this.init();
            }

            async init() {
                await this.loadPhotos();
                this.setupEventListeners();
                this.displayPhotos('all');
            }

            async loadPhotos() {
                // First try to load from JSON file
                try {
                    const response = await fetch('./json/wedding_outline.json');
                    const data = await response.json();
                    const galleryContent = data.sections.find(section => section.id === 'gallery')?.content;
                    
                    if (galleryContent) {
                        // Load photos from JSON
                        this.loadPhotosFromJSON(galleryContent);
                        this.updateStatistics();
                        return;
                    }
                } catch (error) {
                    console.log('Could not load from JSON, using dummy photos');
                }

                // Fallback to dummy photos
                const categories = ['engagement', 'prewedding', 'throwback', 'wedding', 'traditionalCeremony', 'christmas', 'whiteWedding', 'specialMoments'];
                
                for (const category of categories) {
                    try {
                        // Load 4 dummy photos per category based on your folder structure
                        for (let i = 1; i <= 4; i++) {
                            const photo = {
                                src: `images/${category}/femi_beauty${i}.jpg`,
                                category: category,
                                title: `${this.formatCategoryName(category)} Photo ${i}`,
                                description: `Beautiful ${category} moment captured`
                            };
                            this.photoCategories[category].push(photo);
                            this.allPhotos.push(photo);
                        }
                    } catch (error) {
                        console.log(`Could not load photos from ${category} folder`);
                    }
                }

                // Update all statistics
                this.updateStatistics();
            }

            loadPhotosFromJSON(galleryContent) {
                // Map JSON photo section names to category names
                const sectionMapping = {
                    'portraitPhotos': 'portrait',
                    'engagementPhotos': 'engagement',
                    'preweddingPhotos': 'prewedding',
                    'throwbackPhotos': 'throwback',
                    'weddingPhotos': 'wedding',
                    'traditionalCeremonyPhotos': 'traditionalCeremony',
                    'christmasPhotos': 'christmas',
                    'whiteWeddingPhotos': 'whiteWedding',
                    'specialMomentsPhotos': 'specialMoments'
                };

                // Initialize portrait category if not exists
                if (!this.photoCategories.portrait) {
                    this.photoCategories.portrait = [];
                }

                Object.entries(sectionMapping).forEach(([jsonKey, category]) => {
                    if (galleryContent[jsonKey]) {
                        galleryContent[jsonKey].forEach(photo => {
                            const photoObj = {
                                src: photo.src,
                                category: category,
                                title: photo.caption || `${this.formatCategoryName(category)} Photo`,
                                description: photo.caption || `Beautiful ${category} moment captured`
                            };
                            
                            if (!this.photoCategories[category]) {
                                this.photoCategories[category] = [];
                            }
                            
                            this.photoCategories[category].push(photoObj);
                            this.allPhotos.push(photoObj);
                        });
                    }
                });
            }

            updateStatistics() {
                // Update total photos
                document.getElementById('totalPhotos').textContent = this.allPhotos.length + '+';
                
                // Update photo categories (count categories that have photos)
                const categoriesWithPhotos = new Set();
                this.allPhotos.forEach(photo => {
                    categoriesWithPhotos.add(photo.category);
                });
                document.getElementById('photoCategories').textContent = categoriesWithPhotos.size;
                
                // Calculate days together (from when they first met)
                const relationshipStart = new Date('2020-01-15'); // When Beauty & Femi first met
                const today = new Date();
                const daysTogether = Math.floor((today - relationshipStart) / (1000 * 60 * 60 * 24));
                document.getElementById('daysTogether').textContent = daysTogether + '+';
                
                // Memories count stays infinite (∞) as it's symbolic
                document.getElementById('memoriesCount').textContent = '∞';
            }

            formatCategoryName(category) {
                switch(category) {
                    case 'portrait': return 'Portrait';
                    case 'prewedding': return 'Pre-Wedding';
                    case 'throwback': return 'Throwback';
                    case 'engagement': return 'Engagement';
                    case 'wedding': return 'Wedding';
                    case 'traditionalCeremony': return 'Traditional Ceremony';
                    case 'christmas': return 'Christmas';
                    case 'whiteWedding': return 'White Wedding';
                    case 'specialMoments': return 'Special Moments';
                    default: return category.charAt(0).toUpperCase() + category.slice(1);
                }
            }

            setupEventListeners() {
                // Tab switching
                document.querySelectorAll('[data-bs-toggle="pill"]').forEach(tab => {
                    tab.addEventListener('shown.bs.tab', (e) => {
                        const targetId = e.target.getAttribute('data-bs-target').substring(1);
                        this.displayPhotos(targetId);
                    });
                });

                // Desktop lightbox navigation
                document.getElementById('prevPhoto').addEventListener('click', () => this.showPreviousPhoto());
                document.getElementById('nextPhoto').addEventListener('click', () => this.showNextPhoto());

                // Mobile lightbox navigation
                document.getElementById('mobilePrevBtn').addEventListener('click', () => this.showPreviousPhoto());
                document.getElementById('mobileNextBtn').addEventListener('click', () => this.showNextPhoto());
                document.getElementById('mobileCloseBtn').addEventListener('click', () => {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('lightboxModal'));
                    if (modal) modal.hide();
                });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (document.getElementById('lightboxModal').classList.contains('show')) {
                        if (e.key === 'ArrowLeft') this.showPreviousPhoto();
                        if (e.key === 'ArrowRight') this.showNextPhoto();
                        if (e.key === 'Escape') bootstrap.Modal.getInstance(document.getElementById('lightboxModal')).hide();
                    }
                });

                // Touch/swipe navigation for mobile
                this.setupTouchNavigation();
            }

            displayPhotos(category) {
                this.currentCategory = category;
                let photosToShow = [];

                if (category === 'all') {
                    photosToShow = this.allPhotos;
                } else {
                    photosToShow = this.photoCategories[category] || [];
                }

                this.currentPhotos = photosToShow;
                
                const gridId = category === 'all' ? 'allPhotosGrid' : `${category}PhotosGrid`;
                const grid = document.getElementById(gridId);
                
                if (!grid) return;

                if (photosToShow.length === 0) {
                    grid.innerHTML = `
                        <div class="no-photos">
                            <i class="bi bi-images display-1 text-muted mb-3"></i>
                            <h4>No Photos Yet</h4>
                            <p>Photos for this category will be added soon!</p>
                        </div>
                    `;
                    return;
                }

                grid.innerHTML = photosToShow.map((photo, index) => `
                    <div class="photo-item" data-index="${index}">
                        <img src="${photo.src}" alt="${photo.title}" loading="lazy">
                        <div class="photo-overlay">
                            <h6 class="mb-1">${photo.title}</h6>
                            <small>${photo.description}</small>
                        </div>
                    </div>
                `).join('');

                // Add click listeners to photo items
                grid.querySelectorAll('.photo-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.getAttribute('data-index'));
                        this.openLightbox(index);
                    });
                });
            }

            openLightbox(index) {
                this.currentPhotoIndex = index;
                const photo = this.currentPhotos[index];
                
                if (!photo) return;

                document.getElementById('lightboxImage').src = photo.src;
                document.getElementById('lightboxTitle').textContent = photo.title;
                document.getElementById('lightboxDescription').textContent = photo.description;

                // Update desktop navigation buttons
                document.getElementById('prevPhoto').style.display = this.currentPhotos.length > 1 ? 'inline-block' : 'none';
                document.getElementById('nextPhoto').style.display = this.currentPhotos.length > 1 ? 'inline-block' : 'none';

                // Update mobile navigation buttons
                const showMobileNav = this.currentPhotos.length > 1;
                document.getElementById('mobilePrevBtn').style.display = showMobileNav ? 'block' : 'none';
                document.getElementById('mobileNextBtn').style.display = showMobileNav ? 'block' : 'none';

                const modal = new bootstrap.Modal(document.getElementById('lightboxModal'));
                modal.show();
            }

            showPreviousPhoto() {
                if (this.currentPhotos.length > 1) {
                    this.currentPhotoIndex = (this.currentPhotoIndex - 1 + this.currentPhotos.length) % this.currentPhotos.length;
                    this.updateLightboxContent();
                }
            }

            showNextPhoto() {
                if (this.currentPhotos.length > 1) {
                    this.currentPhotoIndex = (this.currentPhotoIndex + 1) % this.currentPhotos.length;
                    this.updateLightboxContent();
                }
            }

            updateLightboxContent() {
                const photo = this.currentPhotos[this.currentPhotoIndex];
                if (photo) {
                    document.getElementById('lightboxImage').src = photo.src;
                    document.getElementById('lightboxTitle').textContent = photo.title;
                    document.getElementById('lightboxDescription').textContent = photo.description;
                }
            }





            setupTouchNavigation() {
                const lightboxModal = document.getElementById('lightboxModal');
                let startX = 0;
                let endX = 0;

                lightboxModal.addEventListener('touchstart', (e) => {
                    startX = e.changedTouches[0].screenX;
                }, { passive: true });

                lightboxModal.addEventListener('touchend', (e) => {
                    endX = e.changedTouches[0].screenX;
                    this.handleSwipeGesture(startX, endX);
                }, { passive: true });
            }

            handleSwipeGesture(startX, endX) {
                const swipeThreshold = 50;
                const swipeDistance = Math.abs(endX - startX);

                if (swipeDistance > swipeThreshold) {
                    if (endX < startX) {
                        // Swipe left - next photo
                        this.showNextPhoto();
                    } else {
                        // Swipe right - previous photo
                        this.showPreviousPhoto();
                    }
                }
            }
        }

        // Initialize gallery when page loads
        let galleryManager;
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize loading screen
            const loadingScreen = document.getElementById('loading-screen');
            if (loadingScreen) {
                setTimeout(() => {
                    loadingScreen.classList.add('fade-out');
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 500);
                }, 1000);
            }
            
            galleryManager = new GalleryManager();
            initializeRSVPForm();
            initializeFooter();
            
            // Initialize floating action button
            if (typeof initFAB === 'function') {
                initFAB();
            }
            
            // Expose a function that can be called when the page is loaded dynamically
            window.initGalleryPage = function() {
                if (!window.galleryManager) {
                    galleryManager = new GalleryManager();
                }
                initializeRSVPForm();
                initializeFooter();
                if (typeof initFAB === 'function') {
                    initFAB();
                }
            };
        });
        
        // Initialize RSVP form
        function initializeRSVPForm() {
            const rsvpForm = document.getElementById('rsvpForm');
            if (rsvpForm) {
                rsvpForm.onsubmit = function(e) {
                    e.preventDefault();
                    const formData = new FormData(rsvpForm);
                    const submitBtn = rsvpForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    
                    // Show submitting state
                    submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Submitting...';
                    submitBtn.disabled = true;
                    
                    // Simulate form submission (replace with actual endpoint in production)
                    setTimeout(() => {
                        rsvpForm.style.display = 'none';
                        document.getElementById('rsvpConfirmation').style.display = 'block';
                        
                        // Reset button state
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }, 1500);
                };
            }
        }
        
        // Toggle guest details based on attendance
        function toggleGuestDetails(attending) {
            const guestDetailsSection = document.getElementById('guestDetailsSection');
            if (guestDetailsSection) {
                guestDetailsSection.style.display = attending ? 'block' : 'none';
                
                // Update required attribute for inputs in this section
                const requiredInputs = guestDetailsSection.querySelectorAll('[required]');
                requiredInputs.forEach(input => {
                    input.required = attending;
                });
            }
        }
        
        // Initialize RSVP form in gallery
        function initializeRSVPForm() {
            const form = document.getElementById('galleryRsvpForm');
            if (form) {
                // Set initial state of guest details
                const attendingYes = document.getElementById('attending_yes');
                const attendingNo = document.getElementById('attending_no');
                
                if (attendingYes && attendingNo) {
                    toggleGuestDetails(attendingYes.checked);
                }
                
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const submitBtn = form.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Submitting...';
                    submitBtn.disabled = true;
                    
                    fetch(form.action, {
                        method: form.method,
                        body: new FormData(form),
                        headers: { 'Accept': 'application/json' }
                    })
                    .then(response => {
                        if (response.ok) {
                            form.style.display = 'none';
                            document.getElementById('galleryRsvpConfirmation').style.display = 'block';
                        } else {
                            alert('There was an error submitting your RSVP. Please try again.');
                        }
                    })
                    .catch(() => {
                        alert('There was an error submitting your RSVP. Please check your connection and try again.');
                    })
                    .finally(() => {
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    });
                });
            }
        }
        
        // Initialize footer content
        async function initializeFooter() {
          try {
            const footers = document.querySelectorAll('.footer');
            
            footers.forEach(footer => {
              renderFooterContent(footer);
            });
          } catch (error) {
            console.error("Error initializing footer:", error);
          }
        }
        
        // Render footer content from JSON data
        function renderFooterContent(footerElement) {
          const footer = footerData.footer;
          
          const footerHTML = `
            <div class="container">
              <div class="row">
                <div class="col-md-6">
                  <div class="footer-content">
                    <h5>${footer.leftColumn.title}</h5>
                    <p>${footer.leftColumn.subtitle}</p>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="footer-hashtag">
                    <h3>${footer.rightColumn.hashtag}</h3>
                    <p>${footer.rightColumn.message}</p>
                  </div>
                </div>
              </div>
              <hr class="footer-divider">
              <div class="row">
                <div class="col-12 text-center">
                  <p class="footer-copyright">
                    ${footer.copyright.text}
                    <br>
                    <small>${footer.copyright.attribution.text} <i class="${footer.copyright.attribution.icon}"></i> by <a href="${footer.copyright.attribution.linkUrl}" target="${footer.copyright.attribution.linkTarget}" rel="${footer.copyright.attribution.linkRel}" class="${footer.copyright.attribution.linkClass}">${footer.copyright.attribution.linkText}</a></small>
                  </p>
                </div>
              </div>
            </div>
          `;
          
          footerElement.innerHTML = footerHTML;
        }
    </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    
    <!-- Critical Modularized JavaScript (load first) -->
    <script src="scripts/data.js"></script>
    <script src="scripts/utils.js"></script>
    
    <!-- Feature JavaScript -->
    <script src="scripts/colors.js" defer></script>
    <script src="scripts/gallery-navigation.js" defer></script>
    <script src="scripts/footer.js" defer></script>
    <script src="scripts/gallery.js" defer></script>
    <script src="scripts/forms.js" defer></script>
    <script src="scripts/copy-buttons.js" defer></script>
    <script src="scripts/share.js" defer></script>
    <script src="scripts/card-animations.js" defer></script>
    
    <!-- Main init scripts (load last) -->
    <script src="scripts/gallery-init.js" defer></script>
    <!-- script.js is intentionally excluded to prevent navigation overrides -->
    <script src="scripts/fab.js" defer></script>
    
    <!-- Final Navigation Override - Ensure the gallery navigation is not overridden -->
    <script>
      // Run this script last to ensure the navigation shows correctly
      document.addEventListener("DOMContentLoaded", function() {
        // Run after a delay to ensure it overrides any other initialization scripts
        setTimeout(function() {
          console.log("Final navigation check: ensuring gallery navigation is applied");
          const navbarMenu = document.getElementById("navbarMenu");
          if (!navbarMenu) return;
          
          // Only override if not set up by gallery-navigation.js
          if (window._galleryNavigationBuilt !== true) {
            console.log("Gallery navigation was overridden, reapplying...");
            
            // Clear existing navigation
            navbarMenu.innerHTML = "";
            
            // Add Home link
            const homeLi = document.createElement("li");
            homeLi.className = "nav-item";
            const homeLink = document.createElement("a");
            homeLink.className = "nav-link";
            homeLink.href = "index.html";
            homeLink.innerHTML = '<i class="bi bi-house"></i> Home';
            homeLi.appendChild(homeLink);
            navbarMenu.appendChild(homeLi);
            
            // Add RSVP link
            const rsvpLi = document.createElement("li");
            rsvpLi.className = "nav-item";
            const rsvpLink = document.createElement("a");
            rsvpLink.className = "nav-link";
            rsvpLink.href = "rsvp.html";
            rsvpLink.id = "rsvp-nav-link";
            rsvpLink.innerHTML = '<i class="bi bi-heart-fill"></i> RSVP';
            rsvpLi.appendChild(rsvpLink);
            navbarMenu.appendChild(rsvpLi);
            
            // Set flag
            window._galleryNavigationBuilt = true;
          } else {
            console.log("Gallery navigation already correctly set up");
          }
        }, 300);
      });
    </script>
    
    <!-- Gallery Lightbox Modal -->
    <div class="gallery-lightbox" id="galleryLightbox">
      <div class="gallery-lightbox-content">
        <span class="gallery-lightbox-close">&times;</span>
        <div class="gallery-lightbox-image-container">
          <img src="" alt="Gallery Image" id="galleryLightboxImage" class="gallery-lightbox-image">
          <p id="galleryLightboxCaption" class="gallery-lightbox-caption"></p>
        </div>
        <button class="gallery-lightbox-nav gallery-lightbox-prev">
          <i class="bi bi-chevron-left"></i>
        </button>
        <button class="gallery-lightbox-nav gallery-lightbox-next">
          <i class="bi bi-chevron-right"></i>
        </button>
        <div class="gallery-lightbox-counter">
          <span id="galleryLightboxCurrent">1</span> / <span id="galleryLightboxTotal">4</span>
        </div>
      </div>
    </div>
    
    <!-- Floating Action Button -->
    <div class="floating-actions">
      <button class="fab-main" id="fabMain" aria-label="Open menu" aria-expanded="false" aria-controls="fabMenu">
        <i class="bi bi-plus" aria-hidden="true"></i>
      </button>
      <div class="fab-menu" id="fabMenu" aria-hidden="true">
        <a href="#rsvp" class="fab-item" title="RSVP" id="rsvp-fab-link">
          <i class="bi bi-heart"></i>
        </a>
        <a href="index.html#contact" class="fab-item" title="Contact">
          <i class="bi bi-envelope"></i>
        </a>
        <a href="#" class="fab-item" title="Share" id="shareBtn">
          <i class="bi bi-share"></i>
        </a>
      </div>
    </div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop">
      <i class="bi bi-arrow-up"></i>
    </button>

    <!-- RSVP Form Handling Script -->
    <script>
        // Initialize RSVP form
        function loadRsvpForm() {
            // Form is already embedded in the page, just initialize handlers
            const rsvpForm = document.getElementById('galleryRsvpForm');
            
            if (rsvpForm) {
                console.log("RSVP form found, initializing...");
                
                // Add submit event listener
                rsvpForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const submitBtn = rsvpForm.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Submitting...';
                        submitBtn.disabled = true;
                    }
                    
                    // Simulate form submission with a delay
                    setTimeout(() => {
                        // Hide the form container
                        const formContainer = document.getElementById('embeddedRsvpForm');
                        if (formContainer) {
                            formContainer.style.display = 'none';
                        }
                        
                        // Show the confirmation message
                        const confirmation = document.getElementById('confirmationMessage');
                        if (confirmation) {
                            confirmation.style.display = 'block';
                        }
                    }, 1000);
                });
                
                // Handle attendance radio changes
                const attendingYes = document.getElementById('attendingYes');
                const attendingNo = document.getElementById('attendingNo');
                
                if (attendingYes && attendingNo) {
                    // Make sure the radio buttons behave correctly
                    attendingYes.addEventListener('change', function() {
                        if (this.checked) {
                            // Show additional fields if needed
                        }
                    });
                    
                    attendingNo.addEventListener('change', function() {
                        if (this.checked) {
                            // Hide additional fields if needed
                        }
                    });
                }
            } else {
                console.error("RSVP form not found in the page");
            }
        }
        
        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize the RSVP form when the page loads
            loadRsvpForm();
            
            // RSVP navigation in navbar is handled in gallery-navigation.js
            
            // Only handle the floating action button if it exists
            const fabLink = document.getElementById('rsvp-fab-link');
            if (fabLink) {
                fabLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.getElementById('rsvp').scrollIntoView({ behavior: 'smooth' });
                });
            }
        });
    </script>
</body>
</html>
